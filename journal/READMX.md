# 区块链
  ezos也正在拥抱以Rollup为中心的路线图；NEAR也正在对数据可用性分片进行设计。本文主要讨论以太坊的模块化趋势。
  
  * ![图片](https://user-images.githubusercontent.com/79394963/191827905-ba9e72b5-e587-4a76-bf29-a704f10c4b18.png)
  
  “区块链不可能三角”又限制了所有属性同时实现极致发展的可能，所以单纯地基于单片区块链的思路做扩容是无法解决以太坊的困境的。
  
  * ![图片](https://user-images.githubusercontent.com/79394963/191828043-46f757a1-6202-40fa-8800-851d8ca77863.png)
  
  
  * 模块化混合扩容：layer1（data sharding）+layer2（rollups）

架构设计主要分为四层：执行层、结算层、共识层、数据可用性层。目前很多情况下，行业内也会把执行层和结算层统一称执行层，共识层和数据可用性层统一称为共识层。

* ![图片](https://user-images.githubusercontent.com/79394963/191828358-1f157787-ed51-45b0-9b82-6c0cd8aeafb1.png)

执行层（Execution Layer）：负责处理链上交易、执行链上订单并验证转账和智能合约的执行，主要将以Rollup为主。模块化区块链发展到一定阶段后，用户通常是基于执行层与区块链进行交互，包括签名交易、部署智能合约以及转移资产等。执行层解决了区块链的可扩展性。

结算层（Settlement Layer）：结算层用于验证Rollup等执行层的执行结果以及解决争议，并结算出状态承诺。

共识层（Consensus Layer）：共识层通过全节点网络下载和执行区块的内容，就状态转换的有效性达成共识，从而提供排序和最终确定性，并以PoS机制验证出块。

数据可用性层（Data Availability Layer）：保证交易数据可以被使用（保证存储且可验证与可用）。需要将验证状态转换有效性所需的数据发布并存储在这一层，一旦遭遇恶意区块提议者扣留交易数据的事件，数据可用性层的数据可用作验证。

* ![图片](https://user-images.githubusercontent.com/79394963/191828523-3cfd2015-98b4-4466-b94f-ab2ba822a573.png)

anksharding引入的核心机制主要：PBS和DAS。

PBS（Proposer builder separation）是指构建区块时区块提议者（Proposer）和区块构建者（builder）分离。由Proposer提议区块，Builder竞拍交易的排序权并计算区块头，Proposer根据Builder的计算结果打包交易并将区块头写入区块完成出块。在PBS之前的区块提议者（Merge前是Miner，Merge后是Validator）可以通过查看mempool中有哪些交易并采取一些策略来获得MEV的机会以最大化他们的挖矿收益。引入PBS机制后，这种角色分离机制结合Builder排序权的竞拍机制可以一定程度上解决MEV问题，最后的MEV收益相当于会被全网验证者共享。除此之外，PBS还有助于解决分片与信标链的同步问题、以太坊网络的抗审查问题等。

* ![图片](https://user-images.githubusercontent.com/79394963/191828675-01b6252f-2ea9-4ad6-9732-688494add75c.png)
DAS（数据可用性抽样，Data Availability Sampling）是解决区块链状态爆炸的有效方法。让验证节点检查区块可用性，通过使用DAS检查，轻客户端可以通过仅下载一些随机选择的块来验证一个块是否已发布。由于DAS可以对区块数据做并行化验证，所以未来数据分片（Data Sharding）的数量即使很多，也不会增加单个验证节点的负担，反而会刺激更多验证节点加入，从而保证验证节点的充分去中心化。

最终，Danksharding能够通过PBS实现以太坊的中心化出块，通过DAS实现去中心化验证，并且具备一定程度的抗审查性，从而确保以太坊成为可扩展的共识层和数据可用性层，并且能够承接住执行层的更多Rollups。（PS：中心化出块、去中心化验证也是Vitalik在Endgame中提出的对以太坊未来发展的构想。）

们首先思考这样一个问题，你要在网上买一本书，交易流程是什么？

第一步：你下单之后把钱打给了支付宝。

第二步：支付宝收款后通知卖家可以发货了。

第三步：卖家收到通知后给你发货。

第四步：你收到货之后很满意，于是确认收货。

第五步：支付宝收到了你的通知并打钱给卖家。


虽然你是在和卖家交易，但是整个交易都是围绕支付宝展开。因此，如果支付宝系统出了问题，比如天上降下来一块陨石，把支付宝的服务器全砸了，或者由于全球经济危机支付宝倒闭了，无奈的支付宝只好淡然地表示不存在这笔交易，那么这笔交易就会以失败告终，到时候买家卖家就会纠缠不清，双方无法自证。

明去中心化的区块链是如何运行的，我们先把整个去中心化的分布式结构简化为一个极端的情况来探究。我们假设有一个去中心化的小城市，在这个城市里有5个可爱活泼的小伙伴，他们互相借钱的时候，是这么干的：

假设B向A借了1块钱，这个时候，城市里的人怎么办呢？A在人群中大喊：“我是A，我借给了B1块钱！”B也在人群中大喊：“我是B，A借给了我1块钱！”

此时城市里的其他人C、D、E都听到了这些消息，他们拿出了手中的小账本并默默记下：“某年某月某日，A借给了B1块钱。

去中心化的模型极度简化之后，我们就会发现，在这个只有5个人的城市中，已经建立了一个去中心化的系统，这个系统不需要银行，也不需要支付宝。这个模型不需要信任关系，也不需要一个拥有公信力的组织。当分布式结构中的每个人都记账的时候，篡改账本是不可行的。比如B突然不认账了：“我不欠A的1块钱！”这个时候，人民群众C或D或E就会站出来说：“不对，我的账本上明明记录了你在某年某月某日向了A借了1块钱，并且没有查到你还款的记录

没有发现一个问题，在这个模型中，所谓的1块钱根本不重要，也没有人在意，“1块钱”已经变成了一个变量，它可以被替换成任何概念，只要大家承认这是一个有价值的东西即可。

比如A在这个城市中大喊一声：“我创造了一个巴拉拉能量！”城市中的其他人都听见了，于是大家纷纷在自己的小本子上记下“某人有一个巴拉拉能量”，大家甚至不用知道巴拉拉能量是什么，A竟然真的有了一个巴拉拉能量。之后呢？A还能干什么呢？A可以再大喊一声：“我给了B一个巴拉拉能量

问题一：凭什么帮你记账？

凭什么你对着天空大喊一声，别人就要帮你记账，别人的时间不要钱吗？别人的小本子不要钱吗？于是，为了让大家都帮我记账，我增加了一条新的规则，我决定给第一个听到我喊话并且将其记录在小本子上的人奖励。奖励机制也很简单，第一个听到我喊话并记录下来的人，可以得到一个巴拉拉能量的奖励。

这个巴拉拉能量不是白给的，是对你劳动的报酬，就像打工可以挣钱一样，你帮我记账，整个系统都会给你报酬。你要做的事情，有这样几点：首先，你要抢在所有人之前听到了我的喊话并记在了自己的小本子上；记录之后，你还要马上告诉整个城市里的人——这句话我记录完了，你们再记录也没有用了，别人就会放弃这笔赚钱的生意；与此同时，你还要做一件事，就是给自己的记录加一个独一无二的编号，然后把记录和编号一起喊出来，于是，下一个人再记录的时候，就会带着这个记录和独一无二的编号继续下去。

* ![图片](https://user-images.githubusercontent.com/79394963/191889909-5274edf9-6e29-4e9f-9df6-497be75cd3b3.png)
区块链系统大约每10分钟会创建一个区块，其中包含了这段时间里全网范围内发生的所有交易。每个区块中也包含了前一个区块的ID（识别码），这使得每个区块都能找到其前一个节点，这样一直倒推就形成了一条完整的交易链条。从诞生之初到运行至今，全网随之形成了一条唯一的主区块链。[3]

二、哈希算法

哈希算法是区块链中保证交易信息不被篡改的单向密码机制。哈希算法接收一段明文后，以一种不可逆的方式将其转化为一段长度较短、位数固定的散列数据。

它有两个特点：

1. 加密过程不可逆，意味着我们无法通过输出的散列数据倒推原本的明文是什么；

2. 输入的明文与输出的散列数据一一对应，任何一个输入信息的变化，都必将导致最终输出的散列数据的变化。

* ![图片](https://user-images.githubusercontent.com/79394963/191890008-19213c90-1194-446b-85cd-02ae6b068fe2.png)

在区块链中，通常使用SHA–256（安全散列算法）进行区块加密，这种算法的输入长度为256位，输出的是一串长度为32字节的随机散列数据。[4]区块链通过哈希算法对一个交易区块中的交易信息进行加密，并把信息压缩成由一串数字和字母组成的散列字符串。区块链的哈希值能够唯一而准确地标识一个区块，区块链中任意节点通过简单的哈希计算都可以获得这个区块的哈希值，计算出的哈希值没有变化也就意味着区块中的信息没有被篡改。

* ![图片](https://user-images.githubusercontent.com/79394963/191890099-a8cda27b-7820-4b96-96f5-0bb0b3070977.png)

在区块链的话题中，我们还经常听到这样的词汇——公钥和私钥。这就是俗称的不对称加密方式，是对以前的对称加密方式（使用用户名与密码）的提高。

我们用电子邮件加密的模型来简单介绍一下：公钥就是给大家用的，你可以通过电子邮件发布，可以通过网站让别人下载，公钥其实是用来加密/验章的。私钥就是自己的，必须非常小心保存，最好加上密码，私钥用来解密/签章，私钥由个人拥有。
在比特币的系统中，私钥本质上是32个字节组成的数组，公钥和地址的生成都依赖私钥，有了私钥就能生成公钥和地址，就能够花费对应地址上面的比特币。私钥花费比特币的方式就是对这个私钥所对应的未花费的交易进行签名。

* ![图片](https://user-images.githubusercontent.com/79394963/191890412-a3fc3873-766f-43b7-bb67-54cb8e5c7cc1.png)


信息发送者：用私钥对信息进行签名，使用信息接收方的公钥对信息加密。

信息接收方：用信息发送者的公钥验证信息发送者的身份，使用私钥对加密信息解密。

四、时间戳

区块链中的时间戳从区块生成的一刻起就存在于区块之中，它对应的是每一次交易记录的认证，证明交易记录的真实性。

时间戳是直接写在区块链中的，而区块链中已经生成的区块不可篡改，因为一旦篡改，生成的哈希值就会变化，从而变成一个无效的数据。每一个时间戳会将前一个时间戳也纳入其随机哈希值中，这一过程不断重复，依次相连，最后会生成一个完整的链条。

* ![图片](https://user-images.githubusercontent.com/79394963/191890665-3744798f-f78a-4545-92b0-7fc42eb36984.png)

区块链利用Merkle树的数据结构存放所有叶子节点的值，并以此为基础生成一个统一的哈希值。Merkle树的叶子节点存储的是数据信息的哈希值，非叶子的节点存储的是对其下面所有叶子节点的组合进行哈希计算后得出的哈希值。[6]

同样地，区块中任意一个数据的变更都会导致Merkle树结构发生变化，在交易信息验证比对的过程中，Merkle树结构能够大大减少数据的计算量，毕竟，我们只需验证Merkle树结构生成的统一哈希值就可以了

* ![图片](https://user-images.githubusercontent.com/79394963/191890714-2a3b605a-0932-4df4-bf16-986b1098d373.png)

比特币的特点之一就是不可篡改，所有的记录都是无法篡改的，并且公开可查。一旦黑客公布的比特币地址收到了比特币，那么账本上就多了一笔记录，每个人手里的账本会同步更新。每个人都能查到这个记录，之后这个地址的各种转账、提现记录也都是可查的。只要黑客进行了比特币提现这类需要和现实交互的操作，就一定会露出蛛丝马迹.

* ![图片](https://user-images.githubusercontent.com/79394963/191890807-49f9998b-c14f-4585-a46a-9a1dc37ce44b.png)

在区块链中，所有的节点向上回溯，都会到达源头，即区块链中的第一个区块，也就是“创世区区块”。

* ![图片](https://user-images.githubusercontent.com/79394963/191890868-46834b6e-f4ca-4dfd-950d-d9f0e27d5e3a.png)

在“创世区块”诞生之后，比特币的用户通过不断地“做题”，即通过计算寻找满足特定SHA–256哈希值对应的数值解。这个过程就是比特币中的“挖矿”。[7]

当任意一个用户优先计算出符合要求的数值解时，就会在全网范围内广播，而网络中的其他节点收到这条信息会进行验证，若通过验证，其他节点就会放弃计算，并将新创建的区块加到前一个区块的后面

* ![图片](https://user-images.githubusercontent.com/79394963/191890915-b696ed3a-ee13-4f36-99c7-b43af80596ca.png)

比特币一个区块的容量是1M，1M=1 024KB（千字节）=1 048 576字节，那么一个区块包含的交易总数为：1 048 576÷250≈4 194.3（笔）。比特币中一个区块确认的时间是10分钟，10分钟=600秒，
那么一个区块每秒能处理的交易数为：4 194.3÷600≈7（个）。区块每秒只能处理7笔交易，要是交易数据再大点，可能连7笔都达不到。这样会造成一个结果，比特币上的交易拥堵而缓慢。一笔交易发生之后，前面还有好多交易在排队等待确认，到底要等到什么时候啊？总有一天堵塞到一定程度就会超过容量极限，然后就崩溃了！
1. Bitcoin Classic（比特币经典版），此方案认为应该将这个字段的最大值调到2M，并且以后有计划取前2 016个区块大小的中位数再乘一个约定好的倍数来决定下一批区块的大小上限。

2. Bitcoin XT（比特币新版），此方案认为这个值应该修改为20M，并且每两年翻一番，直到上限值达到8.3G（千兆字节）。

3. Bitcoin Unlimited（比特币无限版），此方案认为这个值多大都行，甚至可以无限大，由矿池决定其大小。
硬分叉的特点如下：

1. 没有向前兼容性，之前的版本将不可再用，需要强制升级；

2. 在区块链层面会有分叉的两条链，一条旧链，一条分叉新链；

3.需要在某个时间点全部同意分叉升级，不同意的将会进入旧链

软分叉的定义是这样的：

软分叉是指比特币交易的数据结构发生改变时，未升级的节点可以验证已经升级的节点生产出的区块，而且已经升级的节点也可以验证未升级的节点生产出的区块
1. 有较好的兼容性，之前版本的部分功能可用，可不升级；

2. 在区块链层面没有分叉的链，只是组成链的区块有新区块和旧区块之分；

3. 相当长的时间里，可允许不进行升级，继续使用原版本生成旧区块，与新区块并存。

* ![图片](https://user-images.githubusercontent.com/79394963/191891123-2c85479a-3696-4210-8450-6124ff854175.png)

区块链技术实际上是一个分布式数据库，在这个数据库中记账不是由个人或者某个中心化的主体来控制的，而是由所有节点共同维护、共同记账的。所有的单一节点都无法篡改它。

如果你想篡改一个记录，你需要同时控制整个网络超过51%的节点或计算能力才可以，而区块链中的节点无限多且无时无刻都在增加新的节点，这基本上是不可能完成的事情，而且篡改的成本非常高，几乎任何人都承担不起。


# 区块链底层架构

* ![图片](https://user-images.githubusercontent.com/79394963/191891212-daccdc06-1acc-4f26-a028-43721359a159.png)

网络层的主要目的是实现区块链网络中节点之间的信息交流。区块链网络本质上是一个P2P（点对点）网络。每一个节点既接收信息，也产生信息。节点之间通过维护一个共同的区块链来保持通信。

区块链的网络中，每一个节点都可以创造新的区块，在新区块被创造后会以广播的形式通知其他节点，其他节点会对这个区块进行验证，当全区块链网络中超过51%的用户验证通过后，这个新区块就可以被添加到主链上了。

共识层能让高度分散的节点在去中心化的系统中高效地针对区块数据的有效性达成共识。区块链中比较常用的共识机制主要有工作量证明、权益证明和股份授权证明三种，我们在下面的章节中会重点讲解。

激励层的主要功能是提供一定的激励措施，鼓励节点参与区块链的安全验证工作。我们以比特币为例，它的奖励机制有两种。在比特币总量达到2 100万枚之前，奖励机制有两种，新区块产生后系统奖励的比特币和每笔交易扣除的比特币（手续费）。而当比特币总量达到2 100万时，新产生的区块将不再生成比特币，这时奖励机制主要是每笔交易扣除的手续费。

五、合约层

合约层主要是指各种脚本代码、算法机制以及智能合约等。我们以比特币为例，比特币是一种可编程的货币，合约层封装的脚本中规定了比特币的交易方式和过程中涉及的种种细节。

六、应用层

应用层封装了区块链的各种应用场景和案例，比如基于区块链的跨境支付平台OKLink，以及在“应用篇”中我们将讲到的五花八门的应用。

区块链的基本类型

一、公有链

公有链是指全世界任何人都可读取、任何人都能发送交易且交易能获得有效确认，任何人都能参与共识过程的区块链——共识过程决定哪个区块可被添加到区块链中，同时明确当前状态

公有链有如下几个特点：

1. 保护用户免受开发者的影响

在公有链中程序开发者无权干涉用户，区块链可以保护其用户。

2. 访问门槛低

任何人都可以访问，只要有一台能够联网的计算机就能够满足基本的访问条件。

3. 所有数据默认公开

公有链中的每个参与者可以看到整个分布式账本中的所有交易记录。

二、私有链

私有链是指其写入权限仅在一个组织手里的区块链，目的是对读取权限或者对外开放权限进行限制。

* ![图片](https://user-images.githubusercontent.com/79394963/191891347-f6fb3c52-5fdf-4f28-8ae9-f0c51a6a2304.png)

私有链有如下几个特点：

1. 交易速度非常快

私有链中少量的节点具有很高的信任度，并不需要每个节点都来验证一个交易。因此，私有链的交易速度比公有链快很多。

2.为隐私提供更好的保障

私有链的数据不会被公开，不能被拥有网络连接的所有人获得。

3.交易成本大幅降低甚至为零

私有链上可以进行完全免费或者至少说是非常廉价的交易。如果一个实体机构控制和处理所有的交易，它就不再需要为工作收取费用。

4.有助于保护其基本的产品不被破坏

银行和传统的金融机构使用私有链可以保证它们的既有利益，以至原有的生态体系不被破坏。

三、联盟链

联盟链是指其共识过程受到预选节点控制的区块链。例如，对由15个金融机构组成的共同体而言，每个机构都运行着一个节点，为了使每个区块生效需要获得其中半数以上也就是8家机构的确认。区块链可能会允许每个人读取，也可能会受限于参与者走混合路线

* ![图片](https://user-images.githubusercontent.com/79394963/191891396-3aaedbbe-90ed-4335-a4dc-a91618db09e7.png)

区块链分类中的其他几种说法——许可链、混合链和复杂链。

许可链是指每个节点都需要许可才能加入的区块链系统，私有链和联盟链都属于许可链。随着区块链技术的日益发展，区块链的技术架构不再简单地划分为私有链和公有链，它们之间的界限越来越模糊，于是复杂链和混合链的概念就逐渐被人提出来了。

区块链的发展脉络

根据区块链科学研究所创始人梅兰妮·斯万（Melanie Swan）的观点，区块链技术发展分三个阶段或领域：区块链1.0、区块链2.0和区块链3.0。

区块链1.0：以比特币为代表的可编程货币。它更多是指数字货币领域的创新，如货币转移、兑付和支付系统等。

区块链2.0：基于区块链的可编程金融。它更多涉及一些合约方面的创新，特别是商业合同以及交易方面的创新，比如股票、证券、期货、贷款、清算结算、所谓的智能合约等。

区块链3.0：区块链在其他行业的应用。它更多地对应人类组织形态的变革，包括健康、科学、文化和基于区块链的司法、投票等。


# 区块链的共识机制

有两个相距很远的军队要传递信息，蓝军派遣一个信使去跟红军说：“有本事把意大利炮拿出来！”红军收到信息后又派了一个信使去跟蓝军说：“收到指令！”然后蓝军又派一个信使去跟红军说：“知道你收到指令了！”然后红军又派一个信使去跟蓝军说：“知道你知道我收到指令了！”然后蓝军又派一个信使去和红军说：“知道你知道我知道你收到指令了！”然后就没完没了了

在很久很久以前，有一个强大的帝国叫作拜占庭，它的军队非常强大，周围有10个小国家，饱受拜占庭帝国的欺压，但是，必须同一时间有6个以上的国家进攻才有可能打败拜占庭帝国，否则就一定会战败。

这个时候，问题就出现了，古时候军队之间的通信完全依赖于人，如果一个国家的军队里有奸细，无论是下令的将军还是传信的通信兵，都可能会使得另外9个国家收到假消息，从而造成作战失败。那么，如果你是其中一个小国的国王，你该如何判断一定会有另外5个以上的国家与你并肩作战呢？毕竟一个不小心，你就亡国了。

* ![图片](https://user-images.githubusercontent.com/79394963/191891570-a1e4a02c-4dda-4f44-856e-5c7007545ad1.png)

共识机制主要有工作量证明、权益证明和股份授权证明三种。

一、工作量证明

工作量证明（Proof of Work，简称PoW）通常只能从结果证明，因为监测工作过程通常是烦琐且低效的。

比特币在区块的生成过程中使用了PoW机制，一个符合要求的区块哈希值由N个前导零构成，零的个数取决于网络的难度值。要得到合理的区块哈希值需要经过大量的尝试计算，计算时间取决于机器的哈希运算速度。当某个节点提供出一个合理的区块哈希值，说明该节点确实经过了大量的尝试计算，当然，这并不能得出计算次数的绝对值，因为寻找合理的哈希值是一个概率事件。当节点拥有占全网n%的算力时，该节点即有n%的概率找到区块哈希值。

PoW依赖机器进行数学运算来获取记账权，资源消耗大、共识机制高、可监管性弱，同时每次达成共识需要全网共同参与运算，性能效率比较低，容错性方面允许全网50%节点出错。

PoW的优点：完全去中心化，节点自由进出。

PoW的缺点：目前比特币已经吸引全球大部分的算力，其他再使用PoW共识机制的区块链应用很难获得相同的算力来保障自身的安全；挖矿造成大量的资源浪费；共识达成的周期较长。

使用PoW的项目有：比特币、以太坊前三个阶段——Frontier（前沿）、Homestead（家园）、Metropolis（大都会）。以太坊的第4个阶段，即Serenity（宁静），将采用权益证明机制。

二、权益证明

权益证明（Proof of Stake，简称PoS）由“Quantum Mechanic”2011年在比特币论坛讲座上首先提出，后经Peercoin（点点币）和NXT（未来币）以不同思路实现。

PoS的主要理念是节点记账权的获得难度与节点持有的权益成反比，相比PoW，其在一定程度上减少了数学运算带来的资源消耗，性能也得到了相应的提升，但依然是基于哈希运算，竞争获取记账权的方式，可监管性弱。该共识机制的容错性和PoW相同。它是PoW的一种升级，根据每个节点所占代币的比例和时间，等比例地降低挖矿难度，从而加快找到随机数的速度。

在PoW中，一个用户可能拿1 000美元来购买计算机，并加入网络来挖矿以此产生新区块，从而得到奖励。而在PoS中，用户可以拿1 000美元购买等价的代币，并把这些代币当作押金放入PoS机制中，这样用户就有机会产生新区块而得到奖励。

总体而言，这个系统中存在一个持币人的集合，他们把手中的代币放入PoS机制中，这样他们就变成验证者。比如对区块链最前面的一个区块而言，PoS算法在验证者中随机选取一个（选择验证者的权重依据他们投入的代币量，比如一个投入押金为10 000代币的验证者被选择的概率是一个投入1 000代币验证者的10倍），给他权利产生下一个区块。如果在一定时间内，这个验证者没有产生一个区块，则选出第二个验证者代替产生新区块。与PoW一样，PoS以最长的链为准

DPoS的投票模式可以每30秒产生一个新区块，并且在正常的网络条件下，区块链分叉的可能性极其小，即使发生也可以在几分钟内得到解决。执行该模式的基本步骤如下：

1. 成为代表。成为一位代表，你必须在网络上注册你的公钥，并获得一个32位的特有标识符。该标识符会被每笔交易数据的“头部”引用。

2. 授权投票。每个钱包有一个参数设置窗口，在该窗口里用户可以选择一位或更多的代表，并将其分级。一经设定，用户所做的每笔交易将把选票从“输入代表”转移至“输出代表”。一般情况下，用户不会创建专门以投票为目的的交易，因为那将耗费他们一笔交易费。但在紧急情况下，某些用户可能觉得通过支付费用这一更积极的方式来改变他们的投票是值得的。

3. 保持代表诚实。每个钱包将显示一个状态指示器，让用户知道他们的代表表现如何。如果他们错过了太多的区块，那么系统将会推荐用户更换一位新的代表。如果任何代表被发现签发了一个无效的区块，那么所有标准钱包将在每个钱包进行更多交易前要求选出一位新代表。

4. 抵抗攻击。在抵抗攻击上，前100位代表所获得的权力是相同的，即每位代表都有一项平等的投票权，因此，无法通过获得超过1%的选票而将权力集中到单一代表上。由于只有100位代表，不难想象一个攻击者可以对每位轮到其生产区块的代表依次进行拒绝服务攻击。幸运的是，由于每位代表的标识是其公钥而非IP地址，这种特定攻击的威胁很容易被减轻。这将使确定DDoS（分布式拒绝服务）攻击目标更为困难。而代表之间的潜在连接将使妨碍他们生产区块变得更为困难。

* ![图片](https://user-images.githubusercontent.com/79394963/191891656-199c1c9a-75de-446a-bba4-04bc5fe55b6e.png)

asper有惩罚机制，这样非法节点通过恶意攻击网络不仅得不到交易费，而且还面临着保证金被没收的风险。

Casper协议下的验证人需要完成出块和投注两个活动。具体如下：

出块是一个独立于其他所有事件而发生的过程，验证人收集交易，当轮到他们的出块时间时，他们就制造一个区块，并签名，然后发送到网络上。投注的过程更为复杂一些，目前Casper默认的验证人策略被设计为模仿传统的拜占庭容错共识：观察其他的验证人如何投注，取33%处的值，向0或者1进一步移动。

而客户端确认当前状态的过程是这样的：一开始先下载所有的区块和投注，然后用上面的算法来形成自己的意见，但是不公布意见；它只要简单地按顺序在每个高度进行观察，如果一个区块的概率高于0.5就处理它，否则就跳过它。在处理所有的区块之后所得到的状态就可以显示为区块链的“当前状态”。客户端还可以给出对于“最终确定”的主观看法：如果高度k之前的每个区块形成的意见高于99.999%或者低于0.001%，那么客户端就可以认为前k个区块已经最终确定。

五、瑞波共识机制

瑞波共识算法使一组节点能够基于特殊节点列表形成共识。初始特殊节点列表就像一个俱乐部，要接纳一个新成员，必须由该俱乐部51%的会员投票通过。共识遵循这些核心成员的“51%权力”，外部人员则没有影响力。由于该俱乐部由中心化开始，它将一直是中心化的，而如果它开始腐化，股东们什么也做不了。与比特币及Peercoin一样，瑞波系统将股东们与其投票权隔开，因此，它比其他系统更中心化

* ![图片](https://user-images.githubusercontent.com/79394963/191891712-12fc2b91-56df-453d-96a1-abb32bce266b.png)

最早由卡斯特罗和利斯科夫在1999年提出的实用拜占庭容错（PBFT）是第一个得到广泛应用的拜占庭容错算法。只要系统中有2/3的节点是正常工作的，就可以保证一致性。

实用拜占庭容错算法的总体过程如下：客户端向主节点发送请求调用服务操作，如“<REQUEST,o,t,c>”，这里客户端c请求执行操作o，时间戳t用来保证客户端请求只会执行一次。每个由副本节点发给客户端的消息都包含了当前的视图编号，使得客户端能够追踪视图编号，从而进一步推算出当前主节点的编号。客户端通过点对点消息向它自己认为的主节点发送请求，然后主节点自动将该请求向所有备份节点进行广播。

视图编号是连续编号的整数。主节点由公式p = v mod |R|计算得到，这里v是视图编号，p是副本编号，|R|是副本集合的个数。

副本发给客户端的响应为“<REPLY,v,t,c,i,r>”，v是视图编号，t是时间戳，i是副本的编号，r是请求执行的结果。

主节点通过广播将请求发送给其他副本，然后就开始执行三个阶段的任务。

1.预准备阶段。主节点分配一个序列号n给收到的请求，然后向所有备份节点群发预准备消息，预准备消息的格式为“<<PRE–PREPARE,v,n,d>,m>”，这里v是视图编号，m是客户端发送的请求消息，d是请求消息m的摘要。

2. 准备阶段。如果备份节点i接受了预准备消息，则进入准备阶段。在准备的同时，该节点向所有副本节点发送准备消息“<PREPARE,v,n,d,i>”，并且将预准备消息和准备消息写入自己的消息日志。

3. 确认阶段。当“(m,v,n,i)”条件为真的时候，副本i将“<COMMIT,v,n,D(m),i>”向其他副本节点广播，于是就进入了确认阶段。所有副本都执行请求并将结果发回客户端。客户端需要等待不同副本节点发回相同的结果，作为整个操作的最终结果。

如果客户端没有在有限时间内收到回复，请求将向所有副本节点进行广播；如果该请求已经在副本节点处理过了，副本就向客户端重发一遍执行结果；如果请求没有在副本节点处理过，该副本节点将把请求转发给主节点；如果主节点没有将该请求进行广播，那么就认为主节点失效；如果有足够多的副本节点认为主节点失效，则会触发一次视图变更。

. 将C/S（客户机/服务器）架构的请求响应模式改进为适合P2P网络的对等节点模式；

2. 将静态的共识参与节点改进为可动态进入、退出的共识参与节点；

3. 为共识参与节点的产生设计了一套基于持有权益比例的投票机制，通过投票决定共识参与节点（记账节点）；

4. 在区块链中引入数字证书，解决了投票中对记账节点真实身份的认证问题。

授权拜占庭容错机制的优点：专业化的记账人；可以容忍任何类型的错误；记账由多人协同完成；每一个区块都有最终性，不会分叉；算法的可靠性有严格的数学证明。

授权拜占庭容错机制的缺点：当1/3及以上的记账人停止工作后，系统将无法提供服务；当1/3及以上的记账人联合作恶，且其他所有的记账人被恰好分割为两个网络孤岛时，恶意记账人可以使系统出现分叉，但是会留下密码学证据。

总而言之，授权拜占庭容错机制最核心的一点，就是最大限度地确保系统的最终性，使区块链能够适用于真正的金融应用场景。

九、帕克索斯算法

这是一种传统的分布式一致性算法，是一种基于选举领导者的共识机制。领导者节点拥有绝对权限，并允许强监管节点参与，其性能高，资源消耗低。所有节点一般有线下准入机制，但选举过程中不允许有作恶节点，不具备容错性

拜占庭将军问题，是由莱斯利·兰伯特（Leslie Lamport）等人提出的，这是一个点对点通信中的基本问题。其阐述的内涵是，在存在消息丢失的不可靠信道上试图通过消息传递的方式达成一致性是不可能的。因此，对一致性的研究一般假设信道是可靠的，或不存在问题。而2008年出现的比特币区块链则解决了这个“历史遗留问题”

* ![图片](https://user-images.githubusercontent.com/79394963/191891938-287245cc-91d2-4421-94a2-71a22af8fe47.png)

1982年 密码学网络支付系统

戴维·乔姆（David Chaum）提出了注重隐私安全的密码学网络支付系统，该系统具有不可追踪的特性，被认为是比特币区块链在隐私安全方面的雏形。

* ![图片](https://user-images.githubusercontent.com/79394963/191891973-aaeebeae-61e4-4baf-a17f-ec135c157f84.png)

1990年Paxos算法被提出Paxos算法也是莱斯利·兰伯特提出的，这是一种基于消息传递的一致性算法。Paxos算法解决的问题是一个分布式系统如何就某个值（决议）达成一致
* ![图片](https://user-images.githubusercontent.com/79394963/191892021-cb680129-3b63-4e45-9e01-14f3d842a934.png)

斯图尔特·哈伯（Stuart Haber）与W. 斯科特·斯托尔内塔（W. Scott Stornetta）于1991年提出利用时间戳确保数位文件安全的协议，此概念之后被比特币区块链系统采用。

* ![图片](https://user-images.githubusercontent.com/79394963/191892069-fdf7dbfe-43b3-4de8-9a7a-7aa286f32944.png)

1997年 哈希现金技术被发明

亚当·巴克（Adam Back）发明的哈希现金是一种PoW演算法，此演算法依赖成本函数的不可逆特性，从而实现容易被验证但很难被破解的特性，最早被应用于阻挡垃圾邮件。哈希现金之后成为比特币区块链采用的关键技术之一

* ![图片](https://user-images.githubusercontent.com/79394963/191892157-077a12d2-132d-4879-b36f-1bac920bb8b5.png)

尼克·萨博发表了去中心化的数位货币系统Bit Gold，参与者可贡献运算能力解出加密谜题。后来，哈尔·芬尼提出RPoW（可重复使用的工作量证明机制），将B-money与亚当·巴克提出的哈希现金结合起来创造了密码学货币。

* ![图片](https://user-images.githubusercontent.com/79394963/191892218-9868361e-823c-4b92-8dd7-dc281201963b.png)

2010年7月12—16日，比特币汇率经历了为期5天的价格剧烈波动时期，从0.008美元/比特币上涨到0.080美元/比特币，这是比特币汇率发生的第一次价格剧烈波动。

比特币协议中的一个主要漏洞于2010年8月6日被发现：交易信息未经正确验证，就被列入交易记录或区块链。这个漏洞被人恶意利用，生成了1 840亿枚比特币，并被发送到两个比特币地址上。这笔非法交易很快就被发现，漏洞在数小时内修复，非法交易被从交易日志中删除，比特币网络协议也因此升级至更新版本


区块链

这个词可以说是必备词汇了，很多人更倾向于叫它的英文名字：blockchain。而在最近的一次投票中，它又被“公投”成了“公信链”，不过目前为止提到最多的仍然是区块链。它是比特币的底层技术，是一个去中心化的分布式账本系统。区块链与人工智能、大数据并称金融科技的三大巨头。

比特币

这个词差不多是区块链领域中被提及最多的了。比特币是区块链技术的第一个落地应用，最早是一种P2P形式的网络虚拟货币，但是在很多国家，它已经可以购买现实生活中的物品了。如今，比特币已发展成为根据中本聪的思路设计发布的开源软件以及建构其上的P2P网络。

数字货币

区块链最初的应用形式就是数字货币。数字货币是电子形式的替代货币，数字金币和密码货币都属于数字货币。它不能完全等同于虚拟世界中的虚拟货币，因为它常被用于真实的商品和服务交易，而不仅仅局限在网络游戏等虚拟空间中。目前全世界共有数千种数字货币。

PoW

当热爱学习的你想要再深入一点了解区块链的原理时，这个词一定会出现。PoW，也就是工作量证明。比特币在区块的生成过程中使用了PoW机制。一个符合要求的区块哈希值由N个前导零构成，零的个数取决于网络的难度值。要得到合理的区块哈希值需要经过大量的尝试计算，计算时间取决于机器的哈希运算速度。[18]

公钥和私钥

在有关区块链的话题中，我们还会经常听到这两个词汇：公钥和私钥。这就是俗称的不对称加密方式，是对以前的对称加密（使用用户名与密码）方式的提高。

* ![图片](https://user-images.githubusercontent.com/79394963/191892457-957c7c03-916f-4ca7-8cbf-006650d748f9.png)

哈希值

这个词在比特币的世界中可以说是无处不在，哈希算法将任意长度的二进制值映射为固定长度的较小二进制值，这个小的二进制值就是哈希值。哈希值是一段数据唯一且极其紧凑的数值表示形式。哪怕只更改一段明文中的一个字母，随后产生的哈希值都将千差万别。要找到对应同一哈希值的两个不同的输入，从计算的角度来说基本上是不可能的

* ![图片](https://user-images.githubusercontent.com/79394963/191892492-1608d699-17e4-4ed3-8e55-7a2f31f69be0.png)

公有链是指全世界任何人都可读取、任何人都能在其中发送交易信息且交易能够获得有效确认、任何人都能参与共识过程的区块链——共识过程决定哪个区块可被添加到区块链中，也能让参与者明确当前状态。公有链通常被认为是完全去中心化的。而私有链是指其写入权限仅在一个组织手中的区块链。

概括来说，公有链对所有人开放，任何人都可以参与；私有链只对单独的个人或实体开放。[20]

区块和链

区块指的是信息块，每个区块都包含三个要素：本区块的ID；若干交易单；前一个区块的ID。

比特币系统大约每10分钟就会创建一个区块，其中包含了这段时间里全网范围内发生的所有交易。每个区块中也包含了前一个区块的ID，这使得每个区块都能找到它之前的那个节点，这样一直倒推就形成了一条完整的交易链条。从诞生之初至今，全网形成了一条唯一的主区块链。

智能合约也是我们时常听到的词汇，而且听起来似乎可以理解又不可以理解，按照字面意思来看，就是一个自动自觉执行的、有点聪明的合同吧。

* ![图片](https://user-images.githubusercontent.com/79394963/191892623-3c0687f8-8bc9-4830-99a4-e6a49cf736fc.png)
区块链的分布式结构以及基于数学算法的低成本信任机制，为金融领域相关问题的解决和优化提供了一种新思路和路径。目前经济社会中的信用环境比较弱，信用成本比较高，而区块链技术提出了一套成本较低的信任解决方案，对促进信用经济的发展具有重要意义。

![图片](https://user-images.githubusercontent.com/79394963/191892677-7aa61597-66e0-4b21-bb80-56e297eb4047.png)
R3区块链联盟涵盖了70多家全球顶尖金融机构，包括来自中国的中国平安集团、招商银行、中国外汇交易中心、民生银行等4家传统金融机构，目标是打造金融机构的私有区块链系统。

2016年5月，R3开始为旗下的分布式账本联盟寻求2亿美元的A轮融资，R3自身持股10%。随后，R3将目标融资金额下调到1.5亿美元，R3自身持股升至40%，剩余60%股份，则计划主要向联盟42家初始会员银行募集，其后，7家银行选择退出融资。继R3宣布将其开发的区块链平台Corda开源后，包括高盛在内的一些成员退出了R3联盟。
